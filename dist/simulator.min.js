function Simulator(t,s){this.delta_t_ms=this.getOpts(t,"delta_t",100),this.speed_factor=this.getOpts(t,"speed_factor",1),this.output_cb=this.getOpts(t,"output_cb",null),this.delta_t=.001*this.delta_t_ms*this.speed_factor,this.callback=s,this.args=this.getOpts(t,"args",[]),this.X=this.getOpts(t,"X0",[]),this.prev_X=[],this.cont_states=this.getOpts(t,"cont_states",this.X.length),this.t=0,this.time_ms=Date.now(),this.prev_time_ms=Date.now(),this.interval=null,this._replace_vect=!1,this._next_vect=[],this._next_vect_idx=[]}Simulator.prototype={getOpts:function(t,s,i){return void 0===t||void 0===t[s]?i:t[s]},start:function(){if(null===this.interval){var t=this;this.interval=window.setInterval(function(){t.next.apply(t)},this.delta_t_ms)}},stop:function(){window.clearInterval(this.interval),this.interval=null},set_state:function(t){void 0===t?null===this.interval?this.start():this.stop():t?this.start():this.stop()},next:function(t){var s=Date.now(),i=(s-this.time_ms)/1e3;this.time_ms,this.prev_time_ms;this.prev_time_ms=this.time_ms,this.time_ms=s,i=this.delta_t;var e,h=this.callback(this.t,i,this.args,this.X,this);for(e=0;e<h.length;e++)this.prev_X[e]=this.X[e];for(e=0;e<this.cont_states;e++)this.X[e]+=i*h[e];for(e=this.cont_states;e<h.length;e++)this.X[e]=h[e];if(this._replace_vect){var _;if(this._replace_vect=!1,this._next_vect_idx)for(e=0;e<this._next_vect_idx.length;e++)_=this._next_vect_idx[e],this.X[_]=this._next_vect[_];else for(e=0;e<this.X.length;e++)this.X[e]=this._next_vect[e]}this.output_cb&&this.output_cb(this.t,i,this.args,this.X,this),this.t+=i},force_X:function(t,s){this._replace_vect=!0,this._next_vect=t,this._next_vect_idx=void 0===s?[]:s}};