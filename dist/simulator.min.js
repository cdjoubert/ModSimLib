function Simulator(t,i){this.delta_t_ms=this.getOpts(t,"delta_t",100),this.speed_factor=this.getOpts(t,"speed_factor",1),this.output_cb=this.getOpts(t,"output_cb",null),this.delta_t=.001*this.delta_t_ms*this.speed_factor,this.callback=i,this.args=this.getOpts(t,"args",[]),this.X=this.getOpts(t,"X0",[]),this.prev_X=[],this.cont_states=this.getOpts(t,"cont_states",this.X.length),this.t=0,this.output=null,this.outputs=[],this.times=[],this.time_ms=Date.now(),this.prev_time_ms=Date.now(),this.interval=null,this._replace_vect=!1,this._next_vect=[],this._next_vect_idx=[],this._use_real_time=!1}Simulator.prototype={getOpts:function(t,i,s){return void 0===t||void 0===t[i]?s:t[i]},reset:function(t){this.X=t,this.t=0},compute_n:function(t,i,s){var e,h=new Array(t);if(void 0!==s&&(this.delta_t_ms=s,this.delta_t=.001*this.delta_t_ms*this.speed_factor),this.times.length!=t)for(this.times=new Array(t),e=0;e<t;e++)this.times=0;for(e=0;e<t;e++)this.next(),this.times[e]=this.t,h[e]=i?this.output.slice():this.X.slice();return h},start:function(){if(this.times=[],null===this.interval){var t=this;this.interval=window.setInterval((function(){t.next.apply(t)}),this.delta_t_ms)}},stop:function(){window.clearInterval(this.interval),this.interval=null},running:function(t){void 0===t?null===this.interval?this.start():this.stop():t?this.start():this.stop()},next:function(t){var i=this.delta_t;this.delta_t;if(this._use_real_time){var s=Date.now();i=(s-this.time_ms)/1e3,(this.time_ms-this.prev_time_ms)/1e3,this.prev_time_ms=this.time_ms,this.time_ms=s}var e,h,o=this.callback(this.t,i,this.args,this.X,this);for(e=0;e<o.length;e++)this.prev_X[e]=this.X[e];for(e=0;e<this.cont_states;e++)this.X[e]+=i*o[e];for(e=this.cont_states;e<o.length;e++)this.X[e]=o[e];if(this._replace_vect)if(this._replace_vect=!1,this._next_vect_idx)for(e=0;e<this._next_vect_idx.length;e++)h=this._next_vect_idx[e],this.X[h]=this._next_vect[h];else for(e=0;e<this.X.length;e++)this.X[e]=this._next_vect[e];this.output_cb&&this.output_cb(this.t,i,this.args,this.X,this),this.t+=i},force_X:function(t,i){this._replace_vect=!0,this._next_vect=t,this._next_vect_idx=void 0===i?[]:i}};var $GL=function(t){return t.SinGraph=function(t,i){this.placeholder=t,this.plot=null,this.N=getOpts(i,"npoints",20),this.scope=getOpts(i,"scope",!1),this.nperiods=getOpts(i,"nperiods",1),this.tmin=getOpts(i,"tmin",-5),this.tmax=getOpts(i,"tmax",20),this.max=getOpts(i,"max",20),this.options={grid:{borderWidth:1,minBorderMargin:20,labelMargin:10,backgroundColor:{colors:["#fff","#e4f4f4"]},margin:{top:8,bottom:20,left:20},markings:[{xaxis:{from:-5,to:20},yaxis:{from:0,to:0},color:"#000"},{xaxis:{from:0,to:0},yaxis:{from:-20,to:20},color:"#000"}]},xaxis:{ticks:[-5,0,5,10,15,20],axisLabel:"temps (ms)"},yaxis:{min:-this.max,max:+this.max},legend:{show:!0}},this.scope&&(this.tmin=-10,this.tmax=10,this.options.grid.backgroundColor.colors=["#fff","#fff"],this.options.grid.markings=[{xaxis:{from:-10,to:10},yaxis:{from:0,to:0},color:"#000"},{xaxis:{from:0,to:0},yaxis:{from:-5,to:5},color:"#000"}],this.options.xaxis={ticks:[-10,-8,-6,-4,-2,0,2,4,6,8,10],axisLabel:null,color:"#aaa"},this.options.yaxis={ticks:[-5,-4,-3,-2,-1,0,1,2,3,4,5],axisLabel:null,color:"#aaa"})},t.SinGraph.prototype={draw:function(t){if(this.initialized){i=this._create_series(t);this.plot.setData(i),this.plot.draw()}else{this.initialized=!0;var i=this._create_series(t);this.plot=$.plot(this.placeholder,i,this.options)}},_create_sin:function(t,i){for(var s=[],e=0;e<=this.N;++e){var h=this.tmin,o=h+1*(this.tmax-h)*e/this.N,r=2*o*Math.PI*50/1e3,n=t*Math.sin(r+Math.PI/180*i);s.push([o,n])}return s},_create_series:function(t){series=[];for(var i=0;i<t.length;i++){var s={color:getOpts(t[i],"color","black"),data:this._create_sin(t[i].amplitude/(1*getOpts(t[i],"scale",1)),t[i].phase),lines:{fill:!1}};series.push(s)}return series},show_series:function(t,i){var s=this.plot.getData();s[t].lines.show=i,this.plot.setData(s),this.plot.draw()}},t}(($GL=function(t){return t.getOpts=function(t,i,s){return void 0===t||void 0===t[i]?s:t[i]},t.copyObjectFields=function(t,i,s){if(null===s)return{};for(var e=0;e<s.length;e++)void 0!==t[s[e]]&&(i[s[e]]=t[s[e]])},t.Series=function(t){this.opt=t,this.series=null,this.def_opt("points",null),this.def_opt("N",100),this.def_opt("min",0),this.def_opt("max",100),this.def_opt("fct",(function(t,i){return t})),this.def_opt("p",null),this.x1=null,this.d1=null,this.prefill()},t.Series.prototype={def_opt:function(t,i){void 0===this.opt||void 0===this.opt[t]?this[t]=i:this[t]=this.opt[t]},prefill:function(){var t;if(null==this.points)for(this.points=[],this.series=null,t=0;t<this.N;t++){var i=this.min+t/(this.N-1)*(this.max-this.min);this.points.push(i)}},prefill_series:function(t,i){this.series=[];for(var s=t(this.points[0],i),e=Array.isArray(s)?s.length:1,h=0;h<e;h++){this.series[h]=[];for(var o=0;o<this.points.length;o++)this.series[h][o]=[0,0]}},compute:function(t,i){null==t&&null==i?(t=this.fct,i=this.p):null!=i||t&&t.constructor&&t.call&&t.apply?null==i&&(i=this.p):(i=t,t=this.fct),null==this.series&&this.prefill_series(t,i);for(var s=0;s<this.points.length;s++){var e=this.points[s],h=this.fct(e,i);if(Array.isArray(h))for(var o=0;o<h.length;o++)this.series[o][s]=[e,h[o]];else this.series[0][s]=[e,h]}},intersect:function(t,i){var s,e,h,o,r,n,a,l=new Array;s=this.points[0],h=this.series[t][0][1]-this.series[i][0][1];for(var p=1;p<this.points.length;p++)r=this.series[t][p][1]-this.series[i][p][1],o=this.points[p],(h>0&&r<0||h<0&&r>0)&&(a=(e=this.series[t][p-1][1])+((n=(h*o-r*s)/(h-r))-s)*(this.series[t][p][1]-e)/(o-s),l.push([n,a])),s=o,h=r;return l}},t}(($GL=function(t){return t.DynGraph=function(i,s,e){this.initialized=!1,this.placeholder=i,this.plot=null,this.duration=t.getOpts(s,"duration",1),this.yaxes=t.getOpts(s,"yaxes",[{}]),this.plots=e,this.series=[],this.time=0,this.plot_options={grid:{borderWidth:1,minBorderMargin:10,labelMargin:5,backgroundColor:{colors:["#fff","#e4f4f4"]},margin:{top:5,bottom:5,left:5}},xaxis:{axisLabel:"time (s)",color:"black"},yaxes:this.yaxes,legend:{show:!0,position:"nw"}},this._init()},t.DynGraph.prototype={_init:function(){this.nplots=this.plots.length,this.series=[];for(var i=0;i<this.nplots;i++){var s={lines:{fill:!1},data:[]};t.copyObjectFields(this.plots[i],s,["color","label","yaxis"]),this.series.push(s)}this.plot=$.plot(this.placeholder,this.series,this.plot_options)},_update_x:function(){var t=this.plot.getOptions();t.xaxes[0].min=this.time-this.duration,t.xaxes[0].max=this.time},add:function(t,i){this.time+=t;for(var s=0;s<this.nplots;s++)for(this.series[s].data.push([this.time,i[s]]);this.series[s].data[0][0]<this.time-this.duration;)this.series[s].data.shift();this.plot.setData(this.series),this._update_x(),this.plot.setupGrid(),this.plot.draw()}},t}(($GL=function(t){return t.CharacGraph=function(t,i,s){this.initialized=!1,this.placeholder=t,this.plot=null,this.xaxis=$GL.getOpts(i,"xaxis",{}),this.yaxis=$GL.getOpts(i,"yaxis",{}),this.legend=$GL.getOpts(i,"legend",{});var e=$GL.getOpts(i,"interactive",!1);this.plots=s,this.series=[],this.plot_options={grid:{borderWidth:1,minBorderMargin:10,labelMargin:5,backgroundColor:{colors:["#fff","#e4f4f4"]},margin:{top:5,bottom:5,left:5}},xaxis:this.xaxis,yaxis:this.yaxis,legend:this.legend,pan:{interactive:e}},this._init()},t.CharacGraph.prototype={_init:function(){this.nplots=this.plots.length,this.series=[];for(var t=0;t<this.nplots;t++){var i={lines:{fill:!1,show:!0},points:{show:!1},data:[]};$GL.copyObjectFields(this.plots[t],i,["color","label","lines","points","data"]),this.series.push(i)}this.plot=$.plot(this.placeholder,this.series,this.plot_options)},add_series:function(t,i){this.series[t].data=i},update:function(){this.plot.setData(this.series),this.plot.setupGrid(),this.plot.draw()}},t}($GL||{}))||{}))||{}))||{});